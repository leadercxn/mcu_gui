# BK953x


## BK9531 -- TX
* 性能
    1. V段发射功率最大14dBm， U段 10dBm
    2. 同步字寄存器 BK9531_REG39[23:0]
    3. DATA  REG3A[7：0]
    4. ID码  BK9531_REG38，用于对码，防止穿频
    5. ChipID  BK9531_REG70, 0x9531
    6. Device_ID    REG71

* 寄存器
    1. 采样率
        |              | 48K | 32K | 24K | 12K |
        | REG31[31:30] | b'11| b'10| b'01| b'00|
        | REG5 [28:27] | b'00| b'01| b'10| b'11|
        | REG8 [20]    |  0  |   0 |  0  |  0  |
    2. 频段选择: V段 or U段(默认)
        | BK9531 TX工作频率 freq | REG3[21:20] | REG3[15:13] | REG0D(N值) |
        | V段 160MHz ~ 178MHz   |   b'10      |  b'010      | freq*24*2^23/24.576 170MHz:0x53020000 |
        | V段 178MHz ~ 270MHz   |   b'10      |  b'001      | freq*16*2^23/24.576 200MHz:0x411AAAAA |
        | U段 500MHz ~ 710MHz   |   b'01      |  b'001      | freq*6*2^23/24.576  600MHz:0x493E0000 |
        | U段 710MHz ~ 980MHz   |   b'01      |  b'000      | freq*4*2^23/24.576  790MHz:0x404A5555 |
    3. 功率: REGA
        | 发射功率 |     14dB         |   12dB           |      10dB        |       8dB       |
        | V端     | 0x04297070 125mA | 0x04285050 115mA | 0x04264040 105mA | 0x04263030 95mA |
        | U端     |     NC           |      NC          | 0x0F3A4040 100mA | 0x0F3A3030 90mA |
        | 发射功率 |     6dB          |   4dB            |       2dB        |       0dB       |
        | V端     | 0x04262020  90mA | 0x04242020  88mA | 0x04242010  83mA | 0x04241010 78mA |
        | U端     | 0x0F3A2020  85mA | 0x0F3A1020  80mA | 0x0F3A1510  75mA | 0x0F3A1010 73mA |
    4. 麦克风信号能量 mic_rssi
        信号能量 mic_rssi  REG77[7:0]
        信号能量高门限阈值   REG35[31:24]
        信号能量低门限阈值   REG35[23:16]
    5. 自动增益控制
        AGC打开: REG34[27] = 0, REG34[19] = 1
        AGC增益范围最大值: REG33[29:23]
        AGC增益范围最小值: REG33[22:16]
        降低增益速度:      REG34[5:3]
        增加增益速度:      REG34[2:0]
        当前增益值: REG77[14:8]
        信号输入幅度        REG77[31:16]
        高门限             REG34[10:6]
        低门限             REG34[15:11]
        手动增益PGA: REG34[27] = 1,REG34[19] = 0, 增益值 REG34[26:20]
                PGA增益: REG34[26:24] 粗调 * 6dB + REG[23:20] 细调 * 0.5dB
    6. 自动降噪
        自动降噪阈值比较使能: REG33[31]
        低能量门限 REG32[29:20]
        高能量门限 REG32[19:10]
        信号幅值门限 noise_thd REG32[9:0] , 信号只要大于noise_thd关闭静音,小于noise_thd静音
        静音处理方式 REG33[30] 1:PGA静音  0:直接静音


## BK9532 -- RX
* 性能
    1. V端灵明度 -96dBm，U段 -96dBm
    2. 同步字寄存器 BK9531_REG39[23:0]
    3. DATA  BK9532_REG7C [7：0]
    4. ID码  BK9532_REG39，用于对码，防止穿频
    5. ChipID  BK9532_REG70, 0x9532
    6. Device_ID    REG71
    7. 15个可配置系数的均衡器
* 寄存器
    1. 天线
        REG3F[17] 单双天线选择   REG3F[15]单天线时的选择
        REG3F[20] 使能接收信号强度
    2. 接收
        1. 用户数据 REG7C[7:0] -- 对应BK9531的 REG3A[7：0] 数据 ？
                   REG7C[27] CRC校验结果
        2. 本地ID  REG39 -- 对应 BK9531的 REG38 , 接收和发射ID要相同
    3. 增益
        可调增益Gain2 REG32[9:5] 
        自动增益Gain1
    4. 均衡
        均衡开关       REG34[30:16],最低位对应EQ1，最高EQ15，对应为设为1为关闭EQ
        EQ系数寄存器组  REG10~REG2B,REG40~REG58
    5. 静噪
        自动静噪功能              REG32[10]
        自动静噪的渐降/渐升速率     REG32[12:11]
        音频能量指示器RSSI阈值,噪声判断    REG33
    6. 混响
        各混响抽头系数  REG2C~REG2F,REG59
        抽头延迟    REG2F[30:16],REG5A
        滤波参数    REG2D,2E,2F
        简单混响    REG2F[31] = 0
    7. 主/被动啸叫抑制器
        主动移频啸叫抑制开关    REG36[14]
        被动啸叫抑制           REG36[2]
        啸叫标记              REG7A[24]

        主动移频频率    REG35[23:0]

        被动啸叫阈值    REG34[15:0]
    8. 中断
        PLL锁定中断     使能--REG31[29] 中断标志--REG31[25]
        符号中断        使能--REG31[28] 中断标志--REG31[24]
        信号能量中断     使能--REG31[27] 中断标志--REG31[23] -- 指示是否有音频输入
        帧错误中断      使能--REG5F[16] 中断标志--REG31[26]
    9. 能量
        高门限      REG33[31:16]
        低门限      REG33[15:0]
    10. 采样率
        |              | 48K | 32K | 24K | 12K |
        | REG31[31:30] | b'11| b'10| b'01| b'00|
        | REG5 [28:27] | b'11| b'10| b'01| b'00|
        | REG9 [31]    |  0  |   0 |  0  |  0  |
    11. 频段选择: V段 or U段(默认)
        | BK9532 RX工作频率 freq | REG3[15:13] | REG0D(N值) |
        | V段 160MHz ~ 178MHz   |  b'010      | (freq + 0.16384)*24*2^23/24.576 170MHz:0x53167AE1 |
        | V段 178MHz ~ 270MHz   |  b'001      | (freq + 0.16384)*16*2^23/24.576 200MHz:0x412851EB |
        | U段 500MHz ~ 710MHz   |  b'001      | (freq + 0.16384)*6*2^23/24.576  600MHz:0x49431EB8 |
        | U段 710MHz ~ 980MHz   |  b'000      | (freq + 0.16384)*4*2^23/24.576  790MHz:0x404DBF25 |

        | 工作段 | REG3[21:20] | REG7[19:17] | REG8         | REG3E[27:24] |
        | V段   |  b'10       |   b'010     | 0xEDCD874C   |    0x0D      |
        | U段   |  b'01       |   b'111     | 0xEFF1194C   |    0x0F      |









## 共同性能
* 数据帧结构
    + Preamble + Sync-Word + S + Data + Voice + CRC
        1. Data     用户数据
        2. Voice    ADPCM 编码后的数据
        3. CRC      S + Data + Voice

* 性能参数
    1. 数字调制方式：pi/DQPSK
    2. 占用带宽： < 300kHz
    3. 传输速率 204.8Ksps
    4. 音频传输速率：336kbps
    5. 延时：5ms
    6. 信噪比：96dB

* I2C时序
    1. 基本时序模型
        8b 设备号 + 7b 地址 + 1b 读写标记 + 4B 数据 + 写时ACK or 读时NACK
    2. 设备号 BK9532-0x26  BK9531-0x25 存放在 0x71 寄存器

